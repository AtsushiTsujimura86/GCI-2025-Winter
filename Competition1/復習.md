# コンペ１復習

## クロス集計
死亡したなかでの男女比を調べたい。
```python
cross = train.groupby(["Perished", "Sex"]).size().unstack()
```
- Perished=0,Sex=Maleの人数
-  Perished=0,Sex=Femaleの人数
- Perished=1,Sex=Maleの人数
- Perished=1,Sex=Femaleの人数  
`groupby().size()`で、グループごとの人数をカウントする  
`.unstack()`で左を右にする
<img width="192" height="90" alt="image" src="https://github.com/user-attachments/assets/329b216e-b066-45ee-8ca7-13d8c5b55a10" />
<img width="212" height="74" alt="image" src="https://github.com/user-attachments/assets/0b247cfe-0a75-4d8b-a16c-a13ca2b19c89" />
<br>
<br>

```python
cross.plot(kind="bar", stacked=True, color=["skyblue", "lightcoral"])
```
これは pandas の DataFrame.plot() を利用していて、内部で matplotlib が動いている。stacked=Trueで積み上げグラフの指定

<img width="400" height="300" alt="image" src="https://github.com/user-attachments/assets/06da2812-7631-443c-b494-a7534fc7a881" />

## seaborn 基本グラフ
### ヒストグラム
数値データの分布を見る。`kde=True`で密度曲線を重ねられる。分布の歪みや外れ値チェックに使う。
```python
sns.histplot(data=train, x="Age", bins=30, kde=True)
plt.show()
```
<img width="358" height="261" alt="image" src="https://github.com/user-attachments/assets/ea4d3ed6-f2c9-4718-a259-41af8d8dc71d" />


<br>

### 棒グラフ(カテゴリ×数値)
```python
sns.barplot(data=train, x="Pclass", y="Fare", ci=None)
plt.show()
```
<img width="353" height="263" alt="image" src="https://github.com/user-attachments/assets/b9da14ec-d68d-4470-b808-08556392d605" />
<br>

### カウントプロット(カテゴリの件数)
カテゴリデータの件数を棒グラフで表示。
```python
sns.countplot(data=train, x="Sex")
plt.show()
```
<img width="365" height="265" alt="image" src="https://github.com/user-attachments/assets/5c8be68e-7ffc-47b5-95c0-396576d1a63c" />

<br>

### カウントプロット(hue付き)
Perished × Sexのような分析で使う。積み重ね棒グラフではないことに注意。
```python
sns.countplot(data=train, x="Perished", hue="Sex")
plt.show()

```
<img width="355" height="267" alt="image" src="https://github.com/user-attachments/assets/ec47f12c-d3c7-4f4c-a8c5-ce962a9d6bb5" />
<br>


### 箱ひげ図
分布の中央値・四分位・外れ値を可視化。
```python
sns.boxplot(data=train, x="Sex", y="Age")
plt.show()
```
<img width="357" height="263" alt="image" src="https://github.com/user-attachments/assets/f90cb1fe-c185-4b81-9aa6-e8b0551b441c" />

<br>

### バイオリンプロット
boxplot + 密度の形状 → “分布の形” がわかる。
```python
sns.violinplot(data=train, x="Sex", y="Age")
plt.show()

```
<img width="353" height="264" alt="image" src="https://github.com/user-attachments/assets/25a24a63-f511-4e3e-b940-6a729b304f24" />


<br>

### 散布図
数値データ同士の関係を見る。外れ値、相関が直感的にわかりやすく、hueで色分けするとなおよし。
```python
sns.scatterplot(data=train, x="Age", y="Fare", hue="Sex")
plt.show()

```
<img width="359" height="267" alt="image" src="https://github.com/user-attachments/assets/8b6f64d8-28c9-46db-9db6-2e254030fd72" />


<br>

### ヒートマップ
特徴量同士の相関を見るのに最適。どの特徴量同士が強く関係しているかが一目でわかる。特徴量の選択に活用できる。前処理が必要。  
1. ヒートマップは相関行列(corr)を使うため、数値データのみに適用。
2. `.corr()`で相関行列を作成。.corr()の中では、PandasがPearson相関係数を計算している。
Pearson相関とは、二つの変数の関係を-1~1の数値で表すもの。.corr()の結果は以下のようになる。

| Feature   | Age   | SibSp | Parch | Fare  | Pclass | Perished |
|-----------|-------|-------|-------|-------|--------|----------|
| **Age**      | 1.00  | -0.31 | -0.19 |  0.10 | -0.41 | -0.08    |
| **SibSp**    | -0.31 | 1.00  | 0.41  |  0.16 |  0.05 |  0.47    |
| **Parch**    | -0.19 | 0.41  | 1.00  |  0.22 |  0.02 |  0.24    |
| **Fare**     |  0.10 | 0.16  | 0.22  |  1.00 | -0.55 | -0.26    |
| **Pclass**   | -0.41 | 0.05  | 0.02  | -0.55 |  1.00 |  0.32    |
| **Perished** | -0.08 | 0.47  | 0.24  | -0.26 |  0.32 |  1.00    |

3. `plt.figure(figsize=(,))`で図を作成
4. sns.heatmap()で描画。よく使う引数として、corr(必須、相関行列)、amount=True(各マスに相関係数を表示)、cmap="Blues"(seabornのpalette)、fmt=".2f"(数値を小数点２桁で表示)がある。




```python
# train の数値列だけ抽出
numeric_cols = train.select_dtypes(include=["int64", "float64"])

# 相関行列
corr = numeric_cols.corr()

# ヒートマップ
plt.figure(figsize=(10, 8))
sns.heatmap(corr, annot=True, cmap="Blues", fmt=".2f")
plt.title("Correlation Heatmap (Numerical Columns Only)")
plt.show()
```
<img width="484" height="420" alt="image" src="https://github.com/user-attachments/assets/95bbef4a-c5a4-49a0-b069-7dacc3f35e69" />

<br>

### pairプロット
一瞬で「分布+散布図」をすべて確認できる万能ツール。
```python
sns.pairplot(train, vars=["Age", "Fare", "SibSp", "Parch"], hue="Perished")
plt.show()
```
<img width="664" height="615" alt="image" src="https://github.com/user-attachments/assets/d9051f9a-026a-41e4-9506-530bd0dc89a5" />


<br>

### KDEプロット(密度推定)
分布の形を滑らかに描く。
```python
sns.kdeplot(data=train, x="Age", hue="Sex", fill=True)
plt.show()

```
<img width="367" height="268" alt="image" src="https://github.com/user-attachments/assets/fbeabc16-9110-4979-8f4e-724d6abf0fdf" />

<br>


# 使いどころ
| 目的          | 使うグラフ                   |
| ----------- | ----------------------- |
| 数値の分布を見る    | histplot / kdeplot      |
| カテゴリの件数     | countplot               |
| カテゴリごとの平均比較 | barplot                 |
| 分布＋外れ値      | boxplot / violinplot    |
| 相関          | heatmap                 |
| 2変数の関係      | scatterplot |
| 多変数一括チェック   | pairplot                |




